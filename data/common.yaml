organization_domain: dev.studentspex.se
smtp_host: smtp.eu.mailgun.org
smtp_user: postmaster@dev.studentspex.se
smtp_port: 465
keycloak_auth_url: http://%{lookup('keycloak_liss::domain')}/auth

nginx::server_purge: true

keycloak::version: '9.0.2'
keycloak::datasource_driver: postgresql
keycloak::datasource_dbname: keycloak
keycloak::datasource_username: keycloak
keycloak::proxy_https: true

keycloak_liss::batadas_userlookup_url: http://internt.%{organization_domain}/batadasen/api
keycloak_liss::domain: konto.%{organization_domain}

internsidor::domain: internt.%{organization_domain}
internsidor::milter_port: 8082
internsidor::recipient_lookup_port: 9999

mysql::server::remove_default_accounts: true

mediawiki::domain: wiki.%{organization_domain}
mediawiki::baseurl: http://%{lookup('mediawiki::domain')}
mediawiki::version_major_minor: '1.34'
mediawiki::version_patch: '2'

postfix::parameters:
    myorigin: "%{organization_domain}"
    mydestination: "$myhostname localhost %{organization_domain}"
    smtpd_relay_restrictions: permit_mynetworks defer
    mynetworks:
        comments:
            - Allow mail from SUNET email filters
        value: 127.0.0.0/8 192.36.171.200/29 89.45.235.0/28 2001:6b0:8:2::/64 2001:6b0:5a:4019::/64

    smtpd_milters:
        comments:
            - Milter that checks for authorized senders to protected lists and rewrites some subject headers
        value: inet:localhost:%{lookup('internsidor::milter_port')}

    virtual_alias_maps:
        comments:
            - Connects to a daemon that performs a lookup against the database of email lists recipients
        value: socketmap:inet:localhost:%{lookup('internsidor::recipient_lookup_port')}:virtual

    relayhost: "%{smtp_host}:%{smtp_port}"
    smtp_sasl_auth_enable: 'yes'
    smtp_sasl_security_options: noanonymous
    smtp_tls_security_level: encrypt
    smtp_tls_wrappermode: 'yes'
